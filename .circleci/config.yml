version: 2
jobs:
  build:
    docker:
    - image: aparker/circleci-dotnet-mono:latest
    working_directory: ~/oneplusbot
    steps:
    - checkout
    - run: msbuild /t:Restore OnePlusBot.sln
    - run: msbuild /t:Build OnePlusBot.sln
  linux:
    docker:
    - image: aparker/circleci-dotnet-mono:latest
    working_directory: ~/oneplusbot
    steps:
    - checkout
    - run: dotnet publish -c Release -o out-linux -r linux-x64
    - run: git config --global user.name "${GH_NAME}"
    - run: git config --global user.email "${GH_MAIL}"
    - run: rm -rf .git && cd src/OnePlusBot/out-linux/ && git init && git remote add
        origin https://github.com/Rithari/oneplusbot-linux.git && git add ./ -f
    - run: cd src/OnePlusBot/out-linux/ && git commit -m 'Built for Linux'
    - run: cd src/OnePlusBot/out-linux/ && git push --force --quiet "https://${GH_ATOKEN}@github.com/Rithari/oneplusbot-linux">
        /dev/null 2>&1
workflows:
  version: 2
  build:
    jobs:
    - build:
        filters:
          branches:
            ignore: main
  linuxbuild:
    jobs:
    - linux:
        filters:
          branches:
            only: main
